{% extends 'base.html' %} {% block content %}
<div class="container mt-5">
	<div class="row">
		<div class="col-md-4">
			<!-- Sidebar with a list of related questions -->
			<h5 class="fw-bold">{{ technology.name }}</h5>
			<ul class="list-group">
				{% for related_question in questions %}
				<li class="list-group-item">
					<a
						href="{% url 'job_me:question_detail' question_id=related_question.id %}"
						class="text-decoration-none"
					>
						{{ related_question.title }}
					</a>
				</li>
				{% empty %}
				<li class="list-group-item">No related questions available.</li>
				{% endfor %}
			</ul>
		</div>

		<div class="col-md-8">
			<!-- Question Title -->
			<h2 class="fw-bold">{{ question.title }}</h2>
			<p><strong>Difficulty:</strong> {{ question.get_difficulty_display }}</p>

			<!-- Question Content -->
			<div class="mt-3">
				<p>{{ question.question }}</p>
			</div>

			<!-- Show Answer Button -->
			<div class="mt-3">
				<button id="show-answer-btn" class="btn btn-primary">
					Show Answer
				</button>
				<div id="answer" class="mt-2" style="display: none">
					<p><strong>Answer:</strong> {{ question.answer }}</p>
				</div>
			</div>

			<!-- Action buttons to mark knowledge status -->
			<div class="mt-4">
				<button onclick="updateKnowledgeStatus('good')" class="btn btn-success">
					Good Knowledge
				</button>
				<button
					onclick="updateKnowledgeStatus('repeat')"
					class="btn btn-warning"
				>
					Need to Repeat
				</button>
				<button onclick="updateKnowledgeStatus('bad')" class="btn btn-danger">
					Bad Knowledge
				</button>
			</div>
			<!-- Message Placeholder -->
			<div id="status-message" class="mt-2" style="display: none"></div>
		</div>
	</div>
</div>

<script>
	document
		.getElementById('show-answer-btn')
		.addEventListener('click', function () {
			const answerDiv = document.getElementById('answer')
			if (answerDiv.style.display === 'none') {
				answerDiv.style.display = 'block'
				this.textContent = 'Hide Answer'
			} else {
				answerDiv.style.display = 'none'
				this.textContent = 'Show Answer'
			}
		})

	function updateKnowledgeStatus(status) {
		fetch("{% url 'job_me:update_knowledge_status' question.id %}", {
			method: 'POST',
			headers: {
				'Content-Type': 'application/json',
				'X-CSRFToken': '{{ csrf_token }}',
			},
			body: JSON.stringify({ status: status }),
		}).then(response => {
			const messageDiv = document.getElementById('status-message')
			if (response.ok) {
				messageDiv.textContent = 'Status updated successfully!'
				messageDiv.style.color = 'green'
			} else {
				messageDiv.textContent = 'Failed to update status.'
				messageDiv.style.color = 'red'
			}
			messageDiv.style.display = 'block'
		})
	}
</script>

{% endblock %}
