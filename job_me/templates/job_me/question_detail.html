{% extends 'base.html' %} {% block content %}

<div class="container mt-5">
	<a
		class="q-open d-none d-lg-inline-flex"
		data-bs-toggle="offcanvas"
		href="#offcanvasExample"
		role="button"
		aria-controls="offcanvasExample"
	>
		<i class="bi bi-arrow-right"></i>
	</a>

	<div class="row">
		<div class="col-md-3">
			<div
				class="offcanvas offcanvas-start show offcanvas-visible"
				tabindex="-1"
				id="offcanvasExample"
				aria-labelledby="offcanvasExampleLabel"
			>
				<div class="offcanvas-header">
					<div class="d-flex justify-content-between align-items-center w-100">
						<div>{{ technology.name }}</div>
						<div>
							<a
								type="button"
								class="q-open"
								data-bs-dismiss="offcanvas"
								aria-label="Close"
							>
								<i class="bi bi-arrow-left"></i>
							</a>
						</div>
					</div>
				</div>
				<div class="offcanvas-body">
					<ol class="">
						{% for question in questions %}
						<li class="">
							<a
								href="{% url 'job_me:question_detail' question.id %}"
								class="text-decoration-none text-dark"
							>
								{{ question.title }}
							</a>
						</li>
						{% empty %}
						<li class="">No questions available.</li>
						{% endfor %}
					</ol>
				</div>
			</div>
		</div>

		<div class="col-md-8">
			<!-- Question Title -->
			<h2 class="fw-bold">{{ question.title }}</h2>
			<p><strong>Difficulty:</strong> {{ question.get_difficulty_display }}</p>

			<!-- Question Content -->
			<div class="mt-3">
				<p>{{ question.question }}</p>
			</div>

			<!-- Show Answer Button -->
			<div class="mt-3">
				<button id="show-answer-btn" class="btn btn-primary">
					Show Answer
				</button>
				<div id="answer" class="mt-2" style="display: none">
					<p><strong>Answer:</strong> {{ question.answer }}</p>
				</div>
			</div>

			<!-- Action buttons to mark knowledge status -->
			<div class="mt-4">
				<button onclick="updateKnowledgeStatus('good')" class="btn btn-success">
					Good Knowledge
				</button>
				<button
					onclick="updateKnowledgeStatus('repeat')"
					class="btn btn-warning"
				>
					Need to Repeat
				</button>
				<button onclick="updateKnowledgeStatus('bad')" class="btn btn-danger">
					Bad Knowledge
				</button>
			</div>
			<!-- Message Placeholder -->
			<div id="status-message" class="mt-2" style="display: none"></div>
		</div>
	</div>
</div>

<script>
	document.addEventListener('DOMContentLoaded', function () {
		// Show/hide answer functionality
		const showAnswerButton = document.getElementById('show-answer-btn')
		const answerDiv = document.getElementById('answer')

		if (showAnswerButton) {
			showAnswerButton.addEventListener('click', function () {
				if (
					answerDiv.style.display === 'none' ||
					answerDiv.style.display === ''
				) {
					answerDiv.style.display = 'block'
					this.textContent = 'Hide Answer'
				} else {
					answerDiv.style.display = 'none'
					this.textContent = 'Show Answer'
				}
			})
		}

		// Update knowledge status functionality
		function updateKnowledgeStatus(status) {
			fetch("{% url 'job_me:update_knowledge_status' question.id %}", {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json',
					'X-CSRFToken': '{{ csrf_token }}',
				},
				body: JSON.stringify({ status: status }),
			}).then(response => {
				const messageDiv = document.getElementById('status-message')
				if (response.ok) {
					messageDiv.textContent = 'Status updated successfully!'
					messageDiv.style.color = 'green'
				} else {
					messageDiv.textContent = 'Failed to update status.'
					messageDiv.style.color = 'red'
				}
				messageDiv.style.display = 'block'
			})
		}

		// Offcanvas toggle visibility handling
		const offcanvas = document.getElementById('offcanvasExample')
		const openButton = document.querySelector('[data-bs-toggle="offcanvas"]')
		const closeButton = document.querySelector('[data-bs-dismiss="offcanvas"]')

		if (offcanvas) {
			// Remove visibility class when the offcanvas is closed
			offcanvas.addEventListener('hide.bs.offcanvas', function () {
				offcanvas.classList.remove('offcanvas-visible')
			})

			// Add visibility class when the open button is clicked
			if (openButton) {
				openButton.addEventListener('click', function () {
					offcanvas.classList.add('offcanvas-visible')
				})
			}
		}
	})
</script>

{% endblock %}
